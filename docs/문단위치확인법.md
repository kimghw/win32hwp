# 한글 HWP 문단 위치 확인 방법

## 목차
1. [핵심 메서드](#핵심-메서드)
2. [파라미터 의미](#파라미터-의미)
3. [GetPos 메서드](#getpos-메서드)
4. [SetPos 메서드](#setpos-메서드)
5. [GetPosBySet / SetPosBySet](#getposbyset--setposbyset)
6. [KeyIndicator 메서드](#keyindicator-메서드)
7. [MovePos 메서드](#movepos-메서드)
8. [커서 이동 액션](#커서-이동-액션)
9. [실제 사용 예제](#실제-사용-예제)

---

## 핵심 메서드

| 메서드 | 설명 | 반환값 |
|--------|------|--------|
| `GetPos()` | 현재 커서 위치 반환 | (list, para, pos) |
| `SetPos(list, para, pos)` | 특정 위치로 커서 이동 | - |
| `GetPosBySet()` | 현재 위치를 ParameterSet으로 반환 | ParameterSet (ListParaPos) |
| `SetPosBySet(posObj)` | ParameterSet으로 위치 이동 | boolean |
| `KeyIndicator()` | 상태바 정보 (페이지, 줄, 칸 등) | tuple |
| `MovePos(moveID, para, pos)` | 다양한 방식으로 커서 이동 | boolean |

---

## 파라미터 의미

| 파라미터 | 의미 | 설명 |
|----------|------|------|
| **list** | 리스트 ID | 문서 내 영역 구분. 본문=0, 표/각주/글상자 등은 각각 다른 값 |
| **para** | 문단 ID | 문단 번호 (0부터 시작). Enter 키로 구분되는 단위 |
| **pos** | 글자 위치 | 문단 내에서 몇 번째 글자인지 (0부터 시작) |

### 쉽게 설명하면:

- **list**: "어느 영역에 있나?" (본문, 표 안, 각주, 글상자 등)
- **para**: "몇 번째 문단인가?" (Enter로 구분되는 덩어리)
- **pos**: "그 문단에서 몇 번째 글자인가?"

### 예시

```
"안녕하세요"  <- Para=0, Pos=0~4 (5글자)
(빈 줄)      <- Para=1
"반갑습니다"  <- Para=2, Pos=0~4 (5글자)
```

`SetPos(0, 2, 3)` -> 본문(list=0)의 3번째 문단(para=2)에서 4번째 글자(pos=3) 위치로 이동

---

## GetPos 메서드

현재 캐럿의 위치 정보를 얻어옵니다.

### API 정의

```
void GetPos(long FAR* list, long FAR* para, long FAR* pos)
```

### 파라미터

| 파라미터 | 설명 |
|----------|------|
| list | 캐럿이 위치한 문서 내 리스트 아이디 |
| para | 캐럿이 위치한 문단 아이디 |
| pos | 캐럿이 위치한 문단 내 글자 단위 위치 |

### 사용 예시

```python
# Python (win32com)
pos = hwp.GetPos()
list_id = pos[0]  # 리스트 ID (본문=0)
para_id = pos[1]  # 문단 번호
char_pos = pos[2] # 글자 위치

print(f"List={list_id}, Para={para_id}, Pos={char_pos}")
```

### 참고

리스트란 문단과 컨트롤들이 연결된 한글 문서 내 구조를 뜻합니다. 리스트 아이디는 문서 내 위치 정보 중 하나로서 `SelectText`에 넘겨줄 때 사용합니다.

---

## SetPos 메서드

캐럿을 문서 내 특정 위치로 이동시킵니다.

### API 정의

```
void SetPos(long list, long para, long pos)
```

### 파라미터

| 파라미터 | 설명 |
|----------|------|
| list | 캐럿이 위치할 문서 내 리스트 아이디 |
| para | 캐럿이 위치할 문단 아이디 |
| pos | 캐럿이 위치할 문단 내 글자 단위 위치 |

### 사용 예시

```python
# 본문의 3번째 문단(para=2) 시작으로 이동
hwp.SetPos(0, 2, 0)

# 현재 위치 저장 후 복원
current = hwp.GetPos()
# ... 작업 수행 ...
hwp.SetPos(current[0], current[1], current[2])  # 원래 위치로 복원
```

---

## GetPosBySet / SetPosBySet

포인터를 사용할 수 없는 언어(JavaScript, VBScript 등)에서도 사용 가능한 방식입니다.

### GetPosBySet

현재 캐럿의 위치 정보를 ParameterSet(ListParaPos)으로 얻어옵니다.

```python
# Python
pos_set = hwp.GetPosBySet()
list_id = pos_set.Item("List")
para_id = pos_set.Item("Para")
char_pos = pos_set.Item("Pos")
```

### SetPosBySet

ParameterSet으로 얻어진 위치로 캐럿을 옮깁니다.

```python
# 현재 위치 저장
saved_pos = hwp.GetPosBySet()

# 작업 수행...

# 저장된 위치로 복원
hwp.SetPosBySet(saved_pos)
```

### ListParaPos ParameterSet 구조

| Item ID | Type | Description |
|---------|------|-------------|
| List | PIT_UI | 현재 위치한 리스트 |
| Para | PIT_UI | 현재 위치한 문단 |
| Pos | PIT_UI | 현재 위치한 글자 |

---

## KeyIndicator 메서드

상태바에 나타날 정보를 알아냅니다. 페이지, 줄, 칸 등의 정보를 얻을 수 있습니다.

### API 정의

```
BOOL KeyIndicator(long FAR* seccnt, long FAR* secno, long FAR* prnpageno,
                  long FAR* colno, long FAR* line, long FAR* pos,
                  short FAR* over, BSTR FAR* ctrlname)
```

### 반환 파라미터

| 인덱스 | 파라미터 | 설명 |
|--------|----------|------|
| 0 | seccnt | 총 구역 수 |
| 1 | secno | 현재 구역 번호 |
| 2 | prnpageno | 쪽 (페이지 번호) |
| 3 | colno | 단 |
| 4 | line | 줄 |
| 5 | pos | 칸 |
| 6 | over | 수정/삽입 모드 (true=수정, false=삽입) |
| 7 | ctrlname | 컨트롤 이름 |

### 사용 예시

```python
key = hwp.KeyIndicator()

total_sections = key[0]  # 총 구역
current_section = key[1] # 현재 구역
page = key[2]            # 페이지 번호
column = key[3]          # 단
line = key[4]            # 줄
char_col = key[5]        # 칸
is_overwrite = key[6]    # 수정 모드 여부

print(f"페이지: {page}, 줄: {line}, 칸: {char_col}")
print(f"모드: {'수정' if is_overwrite else '삽입'}")
```

### cursor_utils.py 활용

```python
from cursor_utils import get_current_pos, get_hwp_instance

hwp = get_hwp_instance()
pos_info = get_current_pos(hwp)

# 결과:
# {
#     'list_id': 0,
#     'para_id': 5,
#     'char_pos': 10,
#     'page': 1,
#     'line': 3,
#     'column': 15,
#     'insert_mode': '삽입'
# }
```

---

## MovePos 메서드

캐럿의 위치를 다양한 방식으로 이동시킵니다.

### API 정의

```
BOOL MovePos([unsigned int moveID], [unsigned int para], [unsigned int pos])
```

### moveID 값 목록

| ID | 값 | 설명 |
|----|---|------|
| moveMain | 0 | 루트 리스트의 특정 위치 (para, pos로 위치 지정) |
| moveCurList | 1 | 현재 리스트의 특정 위치 (para, pos로 위치 지정) |
| moveTopOfFile | 2 | 문서의 시작으로 이동 |
| moveBottomOfFile | 3 | 문서의 끝으로 이동 |
| moveTopOfList | 4 | 현재 리스트의 시작으로 이동 |
| moveBottomOfList | 5 | 현재 리스트의 끝으로 이동 |
| moveStartOfPara | 6 | 현재 문단의 시작으로 이동 |
| moveEndOfPara | 7 | 현재 문단의 끝으로 이동 |
| moveStartOfWord | 8 | 현재 단어의 시작으로 이동 |
| moveEndOfWord | 9 | 현재 단어의 끝으로 이동 |
| moveNextPara | 10 | 다음 문단의 시작으로 이동 |
| movePrevPara | 11 | 앞 문단의 끝으로 이동 |
| moveNextPos | 12 | 한 글자 앞으로 이동 (서브 리스트 이동 가능) |
| movePrevPos | 13 | 한 글자 뒤로 이동 (서브 리스트 이동 가능) |
| moveNextPosEx | 14 | 한 글자 앞으로 이동 (머리말/꼬리말, 각주/미주, 글상자 포함) |
| movePrevPosEx | 15 | 한 글자 뒤로 이동 (머리말/꼬리말, 각주/미주, 글상자 포함) |
| moveNextChar | 16 | 한 글자 앞으로 이동 (현재 리스트만) |
| movePrevChar | 17 | 한 글자 뒤로 이동 (현재 리스트만) |
| moveNextWord | 18 | 한 단어 앞으로 이동 (현재 리스트만) |
| movePrevWord | 19 | 한 단어 뒤로 이동 (현재 리스트만) |
| moveNextLine | 20 | 한 줄 아래로 이동 |
| movePrevLine | 21 | 한 줄 위로 이동 |
| moveStartOfLine | 22 | 현재 줄의 시작으로 이동 |
| moveEndOfLine | 23 | 현재 줄의 끝으로 이동 |
| moveParentList | 24 | 한 레벨 상위로 이동 |
| moveTopLevelList | 25 | 탑레벨 리스트로 이동 |
| moveRootList | 26 | 루트 리스트로 이동 |
| moveScrPos | 200 | 화면 좌표로 위치 설정 |
| moveScanPos | 201 | GetText() 실행 후 위치로 이동 |

### 표 셀 이동 (100번대)

| ID | 값 | 설명 |
|----|---|------|
| moveLeftOfCell | 100 | 현재 셀의 왼쪽 |
| moveRightOfCell | 101 | 현재 셀의 오른쪽 |
| moveUpOfCell | 102 | 현재 셀의 위쪽 |
| moveDownOfCell | 103 | 현재 셀의 아래쪽 |
| moveStartOfCell | 104 | 현재 행(row)의 시작 |
| moveEndOfCell | 105 | 현재 행(row)의 끝 |
| moveTopOfCell | 106 | 현재 열(column)의 시작 |
| moveBottomOfCell | 107 | 현재 열(column)의 끝 |

### 사용 예시

```python
# 문서 처음으로 이동
hwp.MovePos(2)  # moveTopOfFile

# 문서 끝으로 이동
hwp.MovePos(3)  # moveBottomOfFile

# 현재 문단의 시작으로 이동
hwp.MovePos(6)  # moveStartOfPara

# 한 줄 아래로 이동 (반환값으로 이동 성공 여부 확인)
success = hwp.MovePos(20)  # moveNextLine

# 본문의 특정 위치로 이동 (para=5, pos=10)
hwp.MovePos(0, 5, 10)  # moveMain
```

---

## 커서 이동 액션

`HAction.Run()`으로 실행할 수 있는 커서 이동 관련 액션들입니다.

### 문서/리스트 이동

| Action ID | 설명 |
|-----------|------|
| MoveDocBegin | 문서의 시작으로 이동 (서브 리스트에서 빠져나옴) |
| MoveDocEnd | 문서의 끝으로 이동 (서브 리스트에서 빠져나옴) |
| MoveListBegin | 현재 리스트의 시작으로 이동 |
| MoveListEnd | 현재 리스트의 끝으로 이동 |

### 문단 이동

| Action ID | 설명 |
|-----------|------|
| MoveParaBegin | 현재 문단의 시작으로 이동 |
| MoveParaEnd | 현재 문단의 끝으로 이동 |
| MoveNextParaBegin | 다음 문단의 시작으로 이동 |
| MovePrevParaBegin | 앞 문단의 시작으로 이동 |
| MovePrevParaEnd | 앞 문단의 끝으로 이동 |

### 줄/글자/단어 이동

| Action ID | 설명 |
|-----------|------|
| MoveLineBegin | 현재 줄의 시작으로 이동 |
| MoveLineEnd | 현재 줄의 끝으로 이동 |
| MoveLineUp | 한 줄 위로 이동 |
| MoveLineDown | 한 줄 아래로 이동 |
| MoveLeft | 한 글자 왼쪽으로 이동 |
| MoveRight | 한 글자 오른쪽으로 이동 |
| MoveUp | 위로 이동 |
| MoveDown | 아래로 이동 |
| MoveNextChar | 다음 글자로 이동 |
| MovePrevChar | 이전 글자로 이동 |
| MoveNextWord | 다음 단어로 이동 |
| MovePrevWord | 이전 단어로 이동 |
| MoveWordBegin | 현재 단어의 시작으로 이동 |
| MoveWordEnd | 현재 단어의 끝으로 이동 |

### 페이지/구역 이동

| Action ID | 설명 |
|-----------|------|
| MovePageBegin | 현재 페이지의 시작으로 이동 |
| MovePageEnd | 현재 페이지의 끝으로 이동 |
| MovePageUp | 앞 페이지의 시작으로 이동 |
| MovePageDown | 뒤 페이지의 시작으로 이동 |
| MoveSectionUp | 앞 구역으로 이동 |
| MoveSectionDown | 뒤 구역으로 이동 |

### 선택(셀렉션)하며 이동

| Action ID | 설명 |
|-----------|------|
| MoveSelRight | 오른쪽으로 선택하며 이동 |
| MoveSelLeft | 왼쪽으로 선택하며 이동 |
| MoveSelLineBegin | 줄 시작까지 선택 |
| MoveSelLineEnd | 줄 끝까지 선택 |
| MoveSelParaBegin | 문단 시작까지 선택 |
| MoveSelParaEnd | 문단 끝까지 선택 |
| MoveSelNextWord | 다음 단어까지 선택 |
| MoveSelPrevWord | 이전 단어까지 선택 |
| MoveSelDocBegin | 문서 시작까지 선택 |
| MoveSelDocEnd | 문서 끝까지 선택 |

### 사용 예시

```python
# 문서 처음으로 이동
hwp.HAction.Run("MoveDocBegin")

# 문단 끝으로 이동
hwp.HAction.Run("MoveParaEnd")

# 다음 문단으로 이동
hwp.HAction.Run("MoveNextParaBegin")

# 선택하며 이동
hwp.HAction.Run("MoveSelRight")  # 한 글자 선택
hwp.HAction.Run("MoveSelNextWord")  # 다음 단어까지 선택
```

---

## 주의: 빈 문단도 카운트됨

`BreakPara`를 두 번 실행하면 빈 문단이 생성되며, 이 빈 문단도 Para 번호를 차지합니다.

예시 (문단 사이에 빈 줄이 있는 경우):

| Para | 내용 |
|------|------|
| 0 | 첫 번째 문단 |
| 1 | (빈 줄) |
| 2 | 두 번째 문단 |
| 3 | (빈 줄) |
| 4 | 세 번째 문단 |

빈 줄 없이 문단을 구분하려면 `BreakPara`를 한 번만 실행하세요.

---

## 실제 사용 예제

### 기본: 현재 위치 확인 및 이동

```python
import pythoncom
import win32com.client as win32

# ROT를 통해 기존 한글 인스턴스에 연결
context = pythoncom.CreateBindCtx(0)
rot = pythoncom.GetRunningObjectTable()

hwp = None
for moniker in rot:
    name = moniker.GetDisplayName(context, None)
    if 'HwpObject' in name:
        obj = rot.GetObject(moniker)
        hwp = win32.Dispatch(obj.QueryInterface(pythoncom.IID_IDispatch))
        break

# 현재 위치 확인
pos = hwp.GetPos()
print(f"List={pos[0]}, Para={pos[1]}, Pos={pos[2]}")

# 특정 문단으로 이동
hwp.SetPos(0, 2, 0)  # 3번째 문단(Para=2)의 시작으로 이동

# 문서 끝 위치 저장 후 탐색
hwp.HAction.Run("MoveDocEnd")
end_pos = hwp.GetPos()
hwp.HAction.Run("MoveDocBegin")

# 본문 외 영역(표, 글상자 등) 탐색
area = 1
while True:
    area += 1
    hwp.SetPos(area, 0, 0)
    if hwp.GetPos()[0] == 0:  # 본문으로 돌아오면 종료
        break
```

### 모든 문단 위치 확인

```python
# 문서 처음으로
hwp.HAction.Run('MoveDocBegin')

para_num = 0
while True:
    pos = hwp.GetPos()
    print(f'문단 {para_num}: List={pos[0]}, Para={pos[1]}, Pos={pos[2]}')

    old_pos = pos
    hwp.HAction.Run('MoveNextParaBegin')
    new_pos = hwp.GetPos()

    if old_pos[1] == new_pos[1]:  # 더 이상 이동 안 되면 종료
        break
    para_num += 1
```

### cursor_utils.py 활용 예제

```python
from cursor_utils import (
    get_hwp_instance,
    get_current_pos,
    get_para_range,
    get_line_range,
    get_sentences,
    get_cursor_index
)

hwp = get_hwp_instance()
if hwp is None:
    print("한글이 실행 중이지 않습니다.")
    exit(1)

# 현재 위치 정보 (GetPos + KeyIndicator 결합)
pos_info = get_current_pos(hwp)
print(f"문단: {pos_info['para_id']}, 글자: {pos_info['char_pos']}")
print(f"페이지: {pos_info['page']}, 줄: {pos_info['line']}, 칸: {pos_info['column']}")
print(f"모드: {pos_info['insert_mode']}")

# 문단 범위 확인
para_range = get_para_range(hwp)
print(f"문단 범위: {para_range['start']} ~ {para_range['end']}")

# 현재 줄 범위 확인
line_range = get_line_range(hwp)
print(f"줄 범위: {line_range['start']} ~ {line_range['end']}")

# 문장 목록 확인
sentences = get_sentences(hwp)
for s in sentences:
    print(f"문장 {s['index']}: pos {s['start']} ~ {s['end']}")

# 현재 커서가 몇 번째 문장의 몇 번째 단어인지
cursor_idx = get_cursor_index(hwp)
if cursor_idx:
    print(f"문장 {cursor_idx['sentence_index']}, 단어 {cursor_idx['word_index']}")
```

### GetPosBySet 활용 예제 (JavaScript 스타일)

```python
# 언더라인이 있는 문자열의 시작 pos를 얻어오는 예제
hwp.MovePos(3)  # 문서 끝으로 이동

act = hwp.CreateAction("BackwardFind")
set = act.CreateSet()
act.GetDefault(set)

set.SetItem("IgnoreFindString", 1)
subset = set.CreateItemSet("FindCharShape", "CharShape")
subset.SetItem("UnderlineType", 1)
act.Execute(set)

# GetPosBySet으로 위치 정보 얻기
pos_set = hwp.GetPosBySet()
list_id = pos_set.Item("List")
para_id = pos_set.Item("Para")
char_pos = pos_set.Item("Pos")
print(f"찾은 위치: List={list_id}, Para={para_id}, Pos={char_pos}")
```

---

## 참고 자료

### 공식 문서
- [한컴디벨로퍼 SetPos 공식 문서](https://developer.hancom.com/webhwp/devguide/hwpctrl/methods/setpos)

### 커뮤니티
- [SetPosBySet 활용법 - martinii.fun](https://martinii.fun/255)
- [pyhwpx Cookbook - WikiDocs](https://wikidocs.net/book/8956)

### 로컬 API 문서
- `/home/kimghw/hwp_docs/win32/HwpAutomation_2504_part02.md` - MovePos 상세
- `/home/kimghw/hwp_docs/win32/HwpAutomation_2504_part03.md` - GetPos, SetPos, KeyIndicator
- `/home/kimghw/hwp_docs/win32/ActionTable_2504_part03.md` - Move* 액션 테이블
- `/home/kimghw/hwp_docs/win32/ParameterSetTable_2504_part09.md` - ListParaPos ParameterSet
